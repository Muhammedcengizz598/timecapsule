{% extends 'base.html' %}

{% block title %}Dashboard - TimeCapsule{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <div class="container">
            <h1 class="dashboard-title">Your Time Capsules</h1>
            <button class="btn btn-primary" onclick="showCreateModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Create New Capsule
            </button>
        </div>
    </div>

    <div class="dashboard-content container">
        <div class="capsules-grid" id="capsulesGrid">
            {% for capsule in capsules %}
            <div class="capsule-card" data-capsule-id="{{ capsule.id }}">
                <div class="capsule-header">
                    <div class="capsule-status {% if capsule.is_opened %}opened{% else %}sealed{% endif %}">
                        {% if capsule.is_opened %}Opened{% else %}Sealed{% endif %}
                    </div>
                    <button class="capsule-delete" onclick="deleteCapsule({{ capsule.id }})">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                </div>
                
                <div class="capsule-body">
                    <div class="capsule-message">
                        {{ capsule.message|truncatewords:20 }}
                    </div>
                    
                    <div class="capsule-media">
                        {% if capsule.audio_file %}
                        <span class="media-badge">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </span>
                        {% endif %}
                        {% if capsule.image_file %}
                        <span class="media-badge">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </span>
                        {% endif %}
                        {% if capsule.video_file %}
                        <span class="media-badge">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </span>
                        {% endif %}
                    </div>

                    <div class="capsule-footer">
                        <div class="capsule-date">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span>Opens: {{ capsule.open_date|date:"M d, Y H:i" }}</span>
                        </div>
                        <div class="capsule-countdown" data-open-date="{{ capsule.open_date.isoformat }}">
                            <span class="countdown-text">Calculating...</span>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                    </svg>
                </div>
                <h3>No Time Capsules Yet</h3>
                <p>Create your first time capsule to get started</p>
                <button class="btn btn-primary" onclick="showCreateModal()">Create Your First Capsule</button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div id="createModal" class="modal">
    <div class="modal-content modal-large">
        <span class="close" onclick="closeCreateModal()">&times;</span>
        <h2>Create Time Capsule</h2>
        
        <form id="capsule-form" enctype="multipart/form-data" onsubmit="handleCreateCapsule(event)">
            <div class="form-group">
                <label class="form-label">Your Message</label>
                <textarea id="message" class="form-textarea" rows="5" placeholder="Write a message to your future self..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Open Date & Time</label>
                <input type="datetime-local" id="open-date" class="form-input" required>
            </div>

            <div class="media-upload-grid">
                <div class="upload-box">
                    <label for="audio-upload" class="upload-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                        </svg>
                        <span>Add Audio</span>
                    </label>
                    <input type="file" id="audio-upload" accept="audio/*" hidden>
                    <span id="audio-name" class="file-name"></span>
                </div>

                <div class="upload-box">
                    <label for="image-upload" class="upload-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span>Add Photo</span>
                    </label>
                    <input type="file" id="image-upload" accept="image/*" hidden>
                    <span id="image-name" class="file-name"></span>
                </div>

                <div class="upload-box">
                    <label for="video-upload" class="upload-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        <span>Add Video</span>
                    </label>
                    <input type="file" id="video-upload" accept="video/*" hidden>
                    <span id="video-name" class="file-name"></span>
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block btn-large">Seal Time Capsule</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/dashboard.js"></script>
{% endblock %}
